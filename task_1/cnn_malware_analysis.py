import tensorflow as tf
from tensorflow.keras import layers, models
import numpy as np

def generate_dummy_cyber_data(num_samples=100, img_size=64):
    """
    Simulates the conversion of binary files to grayscale images.
    In a real scenario, you would read .exe bytes and reshape them.
    """
    # Create random images to simulate malware/benign 'visual signatures'
    X = np.random.rand(num_samples, img_size, img_size, 1).astype('float32')
    # Create labels: 0 for Benign, 1 for Malware
    y = np.random.randint(0, 2, size=(num_samples,))
    return X, y

def build_cnn_model(input_shape=(64, 64, 1)):
    """
    Defines a CNN architecture suitable for malware image classification[cite: 28].
    """
    model = models.Sequential([
        # Convolutional Layer: Extracts local features from the 'image'
        layers.Conv2D(32, (3, 3), activation='relu', input_shape=input_shape),
        layers.MaxPooling2D((2, 2)), # Reduces dimensionality
        
        # Second layer for higher-level feature patterns
        layers.Conv2D(64, (3, 3), activation='relu'),
        layers.MaxPooling2D((2, 2)),
        
        # Classifier head
        layers.Flatten(),
        layers.Dense(64, activation='relu'),
        layers.Dropout(0.5), # Prevents overfitting during training
        layers.Dense(1, activation='sigmoid') # Final binary classification
    ])

    model.compile(optimizer='adam',
                  loss='binary_crossentropy',
                  metrics=['accuracy'])
    return model

if __name__ == "__main__":
    print("--- Starting Task 1: CNN for Malware Classification ---")
    
    # 1. Prepare Data
    X_train, y_train = generate_dummy_cyber_data()
    
    # 2. Build Model
    malware_detector = build_cnn_model()
    malware_detector.summary() # Essential for the reader to see the structure [cite: 17]
    
    # 3. Train Model (Short run for demonstration)
    print("\nTraining the model on simulated binary-to-image data...")
    malware_detector.fit(X_train, y_train, epochs=5, batch_size=10, verbose=1)
    
    print("\nProcess complete. Model is ready for evaluation.")
